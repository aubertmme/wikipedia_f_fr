{
	"name": "MyDataFlowRadioA",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "JsonRadioA",
						"type": "DatasetReference"
					},
					"name": "source1"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "fedasil_sql_db1_aaa",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "Select1"
				},
				{
					"name": "CountOfSubtypeByGender"
				},
				{
					"name": "SubsByLocation"
				},
				{
					"name": "OriginalData"
				},
				{
					"name": "Join1"
				},
				{
					"name": "Join2"
				},
				{
					"name": "CleanUp"
				},
				{
					"name": "DerivedColumn1"
				},
				{
					"name": "TsToString",
					"description": "Autogenerated by data preview actions"
				}
			],
			"script": "source(output(\n\t\tartist as string,\n\t\tauth as string,\n\t\tfirstName as string,\n\t\tgender as string,\n\t\titemInSession as short,\n\t\tlastName as string,\n\t\tlength as double,\n\t\tlevel as string,\n\t\tlocation as string,\n\t\tmethod as string,\n\t\tpage as string,\n\t\tregistration as long,\n\t\tsessionId as short,\n\t\tsong as string,\n\t\tstatus as short,\n\t\tts as long,\n\t\tuserId as short\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tdocumentForm: 'documentPerLine') ~> source1\nTsToString select(mapColumn(\n\t\tfirstName,\n\t\tgender,\n\t\tlastName,\n\t\tlevel_type = level,\n\t\tlocation,\n\t\tmethod,\n\t\tpage,\n\t\tregistration,\n\t\tstatus,\n\t\ttimestamp = ts\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 aggregate(groupBy(gender,\n\t\tlevel_type),\n\tcountofsubtypebygender = count(),\n\t\ttimestamp = first(timestamp)) ~> CountOfSubtypeByGender\nSelect1 aggregate(groupBy(location),\n\tSubsByLocation = count(),\n\t\ttimestamp = first(timestamp)) ~> SubsByLocation\nSelect1 select(mapColumn(\n\t\tfirstName,\n\t\tgender,\n\t\tlastName,\n\t\tlevel_type,\n\t\tlocation,\n\t\tmethod,\n\t\tpage,\n\t\tregistration,\n\t\tstatus,\n\t\ttimestamp\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> OriginalData\nOriginalData, CountOfSubtypeByGender join(OriginalData@timestamp == CountOfSubtypeByGender@timestamp,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join1\nJoin1, SubsByLocation join(OriginalData@timestamp == SubsByLocation@timestamp,\n\tjoinType:'left',\n\tmatchType:'exact',\n\tignoreSpaces: false,\n\tbroadcast: 'auto')~> Join2\nJoin2 select(mapColumn(\n\t\tfirstName,\n\t\tgender = OriginalData@gender,\n\t\tlastName,\n\t\tlevel_type = OriginalData@level_type,\n\t\tlocation = OriginalData@location,\n\t\tmethod,\n\t\tpage,\n\t\tregistration,\n\t\tstatus,\n\t\ttimestamp = OriginalData@timestamp,\n\t\tgender = CountOfSubtypeByGender@gender,\n\t\tlevel_type = CountOfSubtypeByGender@level_type,\n\t\tcountofsubtypebygender,\n\t\ttimestamp = CountOfSubtypeByGender@timestamp,\n\t\tlocation = SubsByLocation@location,\n\t\tSubsByLocation,\n\t\ttimestamp = SubsByLocation@timestamp\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> CleanUp\nCleanUp derive(fullname = firstName+' '+lastName,\n\t\tstate = split(location, ', ')[2]) ~> DerivedColumn1\nsource1 derive(ts = toString(ts)) ~> TsToString\nDerivedColumn1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\trecreate:true,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tgender,\n\t\tlevel_type,\n\t\tlocation,\n\t\tregistration,\n\t\tstatus,\n\t\ttimestamp,\n\t\tcountofsubtypebygender,\n\t\tSubsByLocation,\n\t\tfullname,\n\t\tstate\n\t)) ~> sink1"
		}
	}
}